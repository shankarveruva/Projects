<html>
    <head>
        <title>FIT5147 Assignment 1: D3 visualisation</title>
        <style>
            .svgCanvas {
                border: solid 1px
            }
        </style>
    </head>
    <body>
        <svg></svg>
        
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <script>
            window.onload = function(){
                // Canvas width and height
                var width = 1000;
                var height = 700;
                
                // Create a SVG canvas
                var svgCanvas = d3.select("svg")
                    .attr("width", width)
                    .attr("height", height)
                    .attr("class", "svgCanvas");
                
                d3.json("data.json", function(d){
                    console.log(d); 
                    
                    
        var nodes = d.nodes.map(function(thisElement) { return thisElement; });                
        var links = d.links.map(function(thisElement) { return thisElement; });
        
             
        links.forEach(function(link){
            svgCanvas.append('line')
            .attr('x1', function(a){
                nodes.forEach(function(node){
                if (link.node01 == node.id){
                    a=node.x;
//                    return node.x; 
                }      
            });return a;})
            .attr('y1', function(a){
                nodes.forEach(function(node){
                if (link.node01 == node.id){
                    a=node.y
//                    return node.y;  
                }
                    
            }); return a;})
            .attr('x2', function(a){
                nodes.forEach(function(node){
                if (link.node02 == node.id){
                    a=node.x
//                    return node.x;  
                }
            }); return a;})
            .attr('y2', function(a){
                nodes.forEach(function(node){
                if (link.node02 == node.id){
                    a=node.y;
//                    return node.y;  
                }
            }); return a;})
            .attr('stroke-width', function(){
                    return link.amount/150;
            })
            .attr('stroke','black');
        });
              

                    
                    
        svgCanvas.selectAll('circle')
        .data(nodes).enter()
        .append('circle')
        .attr('cx', function(node){
            return node.x;
        })
        .attr('cy', function(node){
            return node.y;
        })
        .attr('r', 20)
        .attr('fill', 'red')
        .on('mouseover', function(node, index){
            svgCanvas.selectAll('circle')
            .attr('opacity', 0.4);
            
//            svgCanvas.selectAll('line')
//            .attr('opacity', 0.4);
        
            d3.select(this)
            .attr('opacity', 1);
            
            svgCanvas.selectAll("line")
            .attr("opacity", function(node){
                links.forEach(function(link){
                    if (link.node01 == node.id || link.node02 == node.id)
                        a = 1
                    else
                        a = 0.4
                }); return a;
            })                
        })
            
            
            
        
        .on('mouseout', function(thisElement, index){
            svgCanvas.selectAll('circle')
            .attr('opacity', 1)
            
            svgCanvas.selectAll('line')
            .attr('opacity', 1);
        });
                           
                    
        });  
                    
                    
}
        </script>
    </body>
</html>